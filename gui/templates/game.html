<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon TCG Pocket - Battle Simulator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .opponent-area {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .player-area {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .pokemon-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .pokemon-card {
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            min-width: 120px;
            text-align: center;
            font-size: 12px;
        }

        .pokemon-card.active {
            border-color: #4caf50;
            background: #e8f5e8;
        }

        .hand-area {
            max-height: 200px;
            overflow-y: auto;
        }

        .hand-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .hand-card {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 6px;
            padding: 8px;
            font-size: 10px;
            text-align: center;
        }

        .actions-area {
            background: #fff8e1;
            border-left: 4px solid #ff9800;
        }

        .options-list {
            margin-top: 10px;
        }

        .option-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .option-button:hover {
            background: #45a049;
        }

        .option-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .game-log {
            background: #fafafa;
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .status-bar {
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            font-weight: bold;
        }

        .waiting-indicator {
            color: #ff9800;
            font-weight: bold;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .energy-info {
            color: #ff9800;
            font-weight: bold;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .pokemon-grid {
                justify-content: center;
            }
            
            .hand-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Pokemon TCG Pocket - Battle Simulator</h1>
        </div>

        <div class="status-bar">
            <div class="status-item">Turn: <span id="turn">-</span></div>
            <div class="status-item">Current Player: <span id="current-player">-</span></div>
            <div class="status-item" id="waiting-status">
                <span class="waiting-indicator" style="display: none;">‚è≥ Waiting for your choice...</span>
            </div>
        </div>

        <div class="game-board">
            <div class="main-area">
                <!-- Opponent Area -->
                <div class="card opponent-area">
                    <div class="section-title">üî¥ <span id="opponent-name">Opponent</span></div>
                    <div class="stats">
                        <span>Hand: <span id="opponent-hand">0</span> cards</span>
                        <span>Deck: <span id="opponent-deck">0</span> cards</span>
                    </div>
                    
                    <div id="opponent-active" class="pokemon-grid">
                        <!-- Opponent's active Pokemon -->
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <strong>Bench:</strong>
                        <div id="opponent-bench" class="pokemon-grid">
                            <!-- Opponent's bench Pokemon -->
                        </div>
                    </div>
                </div>

                <!-- Player Area -->
                <div class="card player-area">
                    <div class="section-title">üîµ <span id="player-name">You</span></div>
                    <div class="stats">
                        <span>Hand: <span id="player-hand">0</span> cards</span>
                        <span>Deck: <span id="player-deck">0</span> cards</span>
                    </div>
                    
                    <div id="player-active" class="pokemon-grid">
                        <!-- Player's active Pokemon -->
                    </div>
                    
                    <div style="margin-top: 10px;">
                        <strong>Bench:</strong>
                        <div id="player-bench" class="pokemon-grid">
                            <!-- Player's bench Pokemon -->
                        </div>
                    </div>
                </div>

                <!-- Hand Area -->
                <div class="card hand-area">
                    <div class="section-title">üÉè Your Hand</div>
                    <div id="player-hand-cards" class="hand-grid">
                        <!-- Player's hand cards -->
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <!-- Actions Area -->
                <div class="card actions-area">
                    <div class="section-title">‚ö° Actions</div>
                    <div id="context-info" style="font-style: italic; margin-bottom: 10px;"></div>
                    <div id="options-container" class="options-list">
                        <p style="color: #666;">No actions available</p>
                    </div>
                </div>

                <!-- Game Log -->
                <div class="card">
                    <div class="section-title">üìù Game Log</div>
                    <div id="game-log" class="game-log">
                        <p>Game starting...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {};
        let updateInterval;

        // Update game state
        async function updateGameState() {
            try {
                const response = await fetch('/api/game_state');
                gameState = await response.json();
                updateDisplay();
            } catch (error) {
                console.error('Error updating game state:', error);
            }
        }

        // Update the display
        function updateDisplay() {
            // Update status bar
            document.getElementById('turn').textContent = gameState.turn || '-';
            document.getElementById('current-player').textContent = gameState.current_player || '-';
            
            // Update waiting indicator
            const waitingIndicator = document.querySelector('.waiting-indicator');
            if (gameState.waiting_for_input) {
                waitingIndicator.style.display = 'inline';
            } else {
                waitingIndicator.style.display = 'none';
            }

            // Update player info
            if (gameState.player_info) {
                const playerInfo = gameState.player_info;
                document.getElementById('player-name').textContent = playerInfo.name;
                document.getElementById('player-hand').textContent = playerInfo.hand_count;
                document.getElementById('player-deck').textContent = playerInfo.deck_count;
                
                updatePlayerPokemon(playerInfo);
                updatePlayerHand(playerInfo.hand);
            }

            // Update opponent info
            if (gameState.opponent_info) {
                const opponentInfo = gameState.opponent_info;
                document.getElementById('opponent-name').textContent = opponentInfo.name;
                document.getElementById('opponent-hand').textContent = opponentInfo.hand_count;
                document.getElementById('opponent-deck').textContent = opponentInfo.deck_count;
                
                updateOpponentPokemon(opponentInfo);
            }

            // Update actions
            updateActions();

            // Update game log
            updateGameLog();
        }

        function updatePlayerPokemon(playerInfo) {
            // Active Pokemon
            const activeContainer = document.getElementById('player-active');
            activeContainer.innerHTML = '';
            if (playerInfo.active) {
                const activeDiv = createPokemonCard(playerInfo.active, true);
                activeContainer.appendChild(activeDiv);
            }

            // Bench Pokemon
            const benchContainer = document.getElementById('player-bench');
            benchContainer.innerHTML = '';
            playerInfo.bench.forEach(pokemon => {
                const pokemonDiv = createPokemonCard(pokemon, false);
                benchContainer.appendChild(pokemonDiv);
            });
        }

        function updateOpponentPokemon(opponentInfo) {
            // Active Pokemon
            const activeContainer = document.getElementById('opponent-active');
            activeContainer.innerHTML = '';
            if (opponentInfo.active) {
                const activeDiv = createPokemonCard(opponentInfo.active, true, false);
                activeContainer.appendChild(activeDiv);
            }

            // Bench Pokemon
            const benchContainer = document.getElementById('opponent-bench');
            benchContainer.innerHTML = '';
            opponentInfo.bench.forEach(pokemon => {
                const pokemonDiv = createPokemonCard(pokemon, false, false);
                benchContainer.appendChild(pokemonDiv);
            });
        }

        function createPokemonCard(pokemon, isActive, showEnergy = true) {
            const div = document.createElement('div');
            div.className = 'pokemon-card' + (isActive ? ' active' : '');
            
            let html = `
                <div style="font-weight: bold;">${pokemon.name}</div>
                <div>HP: ${pokemon.hp}</div>
            `;
            
            if (showEnergy && pokemon.energy) {
                html += `<div class="energy-info">‚ö° ${pokemon.energy}</div>`;
            }
            
            if (showEnergy && pokemon.attacks && pokemon.attacks.length > 0) {
                html += '<div style="margin-top: 5px; font-size: 10px;">';
                pokemon.attacks.forEach(attack => {
                    html += `<div>${attack.name} (${attack.damage})</div>`;
                });
                html += '</div>';
            }
            
            div.innerHTML = html;
            return div;
        }

        function updatePlayerHand(hand) {
            const handContainer = document.getElementById('player-hand-cards');
            handContainer.innerHTML = '';
            
            hand.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'hand-card';
                
                let cardInfo = `<strong>${card.name}</strong><br>(${card.type})`;
                if (card.type === 'pokemon') {
                    cardInfo += `<br>${card.stage}<br>${card.hp} HP`;
                }
                
                cardDiv.innerHTML = cardInfo;
                handContainer.appendChild(cardDiv);
            });
        }

        function updateActions() {
            const contextInfo = document.getElementById('context-info');
            const optionsContainer = document.getElementById('options-container');
            
            if (gameState.waiting_for_input && gameState.options && gameState.options.length > 0) {
                contextInfo.textContent = `Choose ${gameState.current_context}:`;
                
                optionsContainer.innerHTML = '';
                gameState.options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'option-button';
                    button.textContent = `${option.index + 1}. ${option.name}`;
                    button.onclick = () => makeChoice(option.index);
                    optionsContainer.appendChild(button);
                });
            } else {
                contextInfo.textContent = '';
                optionsContainer.innerHTML = '<p style="color: #666;">No actions available</p>';
            }
        }

        function updateGameLog() {
            const logContainer = document.getElementById('game-log');
            if (gameState.game_log && gameState.game_log.length > 0) {
                logContainer.innerHTML = gameState.game_log.join('<br>');
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        async function makeChoice(choiceIndex) {
            try {
                const response = await fetch('/api/make_choice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ choice_index: choiceIndex })
                });
                
                const result = await response.json();
                if (!result.success) {
                    console.error('Choice failed:', result.error);
                }
            } catch (error) {
                console.error('Error making choice:', error);
            }
        }

        // Start updating
        updateGameState();
        updateInterval = setInterval(updateGameState, 1000);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html> 